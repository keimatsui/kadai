# 上位下位関係抽出ツール

[Hyponymy extraction tool](https://alaginrc.nict.go.jp/hyponymy/) のインストール法を説明する。

途中で`wget`でダウンロードするファイルが見つからないときは矢吹に聞くこと。

仮想マシンのスナップショットを撮ってから試すとよい。

## 作業ディレクトリ

```
cd
mkdir tmp
```

## Ruby 1.8（古いRuby）

https://www.brightbox.com/docs/ruby/ubuntu/ を参考にインストールする。

```
sudo apt-get update
sudo apt-get install software-properties-common
sudo apt-add-repository ppa:brightbox/ruby-ng
```

Ruby 1.8をインストールする。

```
sudo apt-get update
sudo apt-get -y install ruby-switch ruby1.8 rubygems1.8 ruby1.8-dev
sudo ruby-switch --set ruby1.8
```
バージョン1.8が使えることを確認する。

```
ruby -v
```

## MeCab

```
sudo apt-get -y install mecab mecab-ipadic-utf8 libmecab-dev
```

### MeCab-Ruby

（http://d.hatena.ne.jp/zariganitosh/20141110/ruby_187_bundler_mecab_ruby を参考にした。）

RubyからMeCabを使えるようにする。（apt-getで入るパッケージ`ruby-mecab`は，古いRubyに対応していない。）

```
cd ~/tmp
wget -O mecab-ruby-0.994.tar.gz https://mecab.googlecode.com/files/mecab-ruby-0.994.tar.gz
tar zxf mecab-ruby-0.994.tar.gz
cd mecab-ruby-0.994
gem build mecab-ruby.gemspec
sudo gem install mecab-ruby
```

#### 動作確認

`test.rb`の3行目に`require 'rubygems'`を追記し，`ruby test.rb`で動作を確認する（解析結果が表示されればOK）。

## Pecco

```
cd ~/tmp
wget http://www.tkl.iis.u-tokyo.ac.jp/~ynaga/pecco/pecco-latest.tar.gz
tar zxf pecco-latest.tar.gz
cd pecco-XXXX-XX-XX #場合による。「pecco」まで入力してTABキーで補完すればよい。
./configure
sudo make install
```

## Hyponymy

```
cd ~/tmp
wget -O ex-hyponymy-1.0.tar.gz https://alaginrc.nict.go.jp/hyponymy/cgi-bin/dl.1.0.cgi
tar zxf ex-hyponymy-1.0.tar.gz
cd ex-hyponymy-1.0
```

パッチを当てる。

```
wget http://www.tkl.iis.u-tokyo.ac.jp/~ynaga/pecco/ex-hyponymy-1.0-pecco.patch
patch -p0 < ex-hyponymy-1.0-pecco.patch
```

さらに，`script/lib/mecab_part.rb`の`require 'Cut'`の前に`require 'rubygems'`を追記する。

```
gedit script/lib/mecab_part.rb &
```

## テスト

### テストデータの作成

1. https://github.com/taroyabuki/yabukilab/blob/master/library/wikipedia/mediawiki/install.md を参考にMediaWikiをインストールする。
1. 数ページ作ってみる。
1. MediaWikiの全データをXMLにダンプする（チーズとワインだけのデータが`cheese-wine.xml.bz2`である）。（https://www.mediawiki.org/wiki/Manual:DumpBackup.php を参考にした。）

```
php /var/www/html/mediawiki/maintenance/dumpBackup.php --current > all-pages.xml
```

`less all-pages.xml`で結果を確認する。

`bzip2 all-pages.xml`で圧縮する。

### テストデータの解析

```
bash script/ex_hyponymy.sh -E -s -t ./data3 all-pages.xml.bz2
```

#### 解析結果

`res_def_all_withWD_posWD`は空。

`res_cat_all_withWD_posWD`

```
果実酒  ワイン  0.999317
発酵食品        チーズ  1.165102
調味料  ワイン  1.329794
```

`res_hier_all_withWD_posWD`

```
チーズ	おもなチーズ	1.070788
チーズ	かまぼこ	0.573202
チーズ	アナログチーズ	1.342489
チーズ	アメリカンチーズ	1.394543
チーズ	インド	0.504947
チーズ	イージーチーズ	1.026433
チーズ	ウルダ	1.060257
チーズ	エダムチーズファイル	1.060257
チーズ	エメンタールチーズ	1.306410
チーズ	カッテージチーズ	1.423409
チーズ	カトゥピリ	1.060257
チーズ	カマンベールチーズ	1.370036
チーズ	カース・マルツゥ	1.060257
チーズ	クラッカー	0.608108
チーズ	クリームチーズ	1.434404
チーズ	クワルク	1.060257
チーズ	グリュイエールチーズ	1.306025
チーズ	ケソ・マンチェゴ	1.060257
チーズ	ゴルゴンゾーラ	1.060257
チーズ	ゴーダチーズ	1.423426
チーズ	スキール	1.060257
チーズ	スティルトンチーズ	1.475679
チーズ	ストリングチーズ	1.297012
チーズ	スペイン	0.539273
チーズ	スモークチーズ	0.999478
チーズ	ダナブルー	1.060257
チーズ	チェダーチーズ	1.622730
チーズ	パルミジャーノ・レッジャーノ	1.187777
チーズ	パン	0.493091
チーズ	ピザ	0.575230
チーズ	フェタチーズ	1.346963
チーズ	ブリーチーズ	1.885944
チーズ	プロボローネ	1.060257
チーズ	ペコリーノ	0.999113
チーズ	ポン・レヴェック	1.060257
チーズ	マスカルポーネ	1.343289
チーズ	モッツァレッラ	1.187139
チーズ	モン・ドール	0.707204
チーズ	ラクレット	0.696620
チーズ	リコッタ	1.098551
チーズ	ルーシャン	1.222751
チーズ	ルーマニア	0.600126
チーズ	ロックフォール	1.060257
チーズ	ロマーノチーズ	1.475679
チーズ	煎餅	0.644193
チーズの加工品	スモークチーズ	0.550230
ワイン	にごりワイン	0.855726
ワイン	アイスワイン	0.999781
ワイン	イタリアワイン	1.160585
ワイン	スペインワイン	0.999838
ワイン	ドイツワイン	0.772266
ワイン	フランスワイン	0.713424
ワイン	フレーバードワイン	0.845487
ワイン	モルドバワイン	0.948368
ワイン	ルクセンブルクワイン	0.512668
ワイン	ロゼワイン	0.763237
ワイン	新緯度帯ワイン	0.550622
ワイン	日本のワイン	0.759698
ワイン	氷結ワイン	1.032213
ワイン	特殊な製法のワイン	0.725371
ワイン	発泡ワイン	0.766697
ワイン	白ワイン	0.984539
ワイン	貴腐ワイン	0.731378
ワイン	赤ワイン	0.529383
ワイン	酒精強化ワイン	1.110763
ワイン	麦わらワイン	1.000009
ワインに関する事件	ジエチレングリコール混入事件	1.368115
料理	かまぼこ	1.165111
料理	ちくわ	0.510169
料理	サンドイッチ	0.818215
料理	パン	1.161055
料理	ピザ	1.113360
料理	フォンデュ	0.963371
料理	ラクレット	1.266992
新緯度帯ワイン・熱帯ワイン	新緯度帯ワイン	0.719916
特殊な製法のワイン	にごりワイン	2.241050
特殊な製法のワイン	アイスワイン	2.086918
特殊な製法のワイン	シュール・リー	1.080467
特殊な製法のワイン	ビオ・ワイン	1.296241
特殊な製法のワイン	フレーバードワイン	1.717948
特殊な製法のワイン	氷結ワイン	2.252565
特殊な製法のワイン	発泡ワイン	2.113156
特殊な製法のワイン	貴腐ワイン	1.956241
特殊な製法のワイン	酒精強化ワイン	1.980093
特殊な製法のワイン	麦わらワイン	2.129827
特殊な醸造技術	果汁再添加	1.593583
特殊な醸造技術	炭酸ガス浸漬法	1.929289
特殊な醸造技術	補糖と補酸	0.988415
産地	ニュージーランド	0.578071
芳香成分	マロクティック発酵に由来	0.516494
芳香成分	果実に由来	0.600021
芳香成分	樽材に由来	0.572992
芳香成分	熟成	0.741337
菓子	イージーチーズ	0.974098
菓子	クッキー	0.983991
菓子	クラッカー	1.477800
菓子	ケーキ	1.217076
菓子	煎餅	1.440737
```

`res_hier_all_withWD_posWD_expand`

```
チーズ	スキール
チーズ	カッテージチーズ
チーズ	クリームチーズ
チーズ	チェダーチーズ
チーズ	アメリカンチーズ
チーズ	スティルトンチーズ
チーズ	ロマーノチーズ
チーズ	モッツァレッラ
チーズ	パルミジャーノ・レッジャーノ
チーズ	ゴルゴンゾーラ
チーズ	リコッタ
チーズ	プロボローネ
チーズ	ペコリーノ
チーズ	マスカルポーネ
チーズ	カース・マルツゥ
チーズ	インド
チーズ	ゴーダチーズ
チーズ	エダムチーズファイル
チーズ	フェタチーズ
チーズ	エメンタールチーズ
チーズ	グリュイエールチーズ
チーズ	ケソ・マンチェゴ
チーズ	スペイン
チーズ	ルーシャン
チーズ	ダナブルー
チーズ	クワルク
チーズ	カトゥピリ
チーズ	カマンベールチーズ
チーズ	ブリーチーズ
チーズ	ロックフォール
チーズ	ポン・レヴェック
チーズ	モン・ドール
チーズ	ウルダ
チーズ	ストリングチーズ
チーズ	ルーマニア
チーズ	おもなチーズ
料理	[発酵食品]の料理	チーズの料理	パン
チーズ	パン
料理	[発酵食品]の料理	チーズの料理	サンドイッチ
料理	[発酵食品]の料理	チーズの料理	ピザ
チーズ	ピザ
料理	[発酵食品]の料理	チーズの料理	フォンデュ
料理	[発酵食品]の料理	チーズの料理	ラクレット
チーズ	ラクレット
料理	[発酵食品]の料理	チーズの料理	ちくわ
料理	[発酵食品]の料理	チーズの料理	かまぼこ
チーズ	かまぼこ
菓子	[発酵食品]の菓子	チーズの菓子	ケーキ
菓子	[発酵食品]の菓子	チーズの菓子	クッキー
菓子	[発酵食品]の菓子	チーズの菓子	クラッカー
チーズ	クラッカー
菓子	[発酵食品]の菓子	チーズの菓子	煎餅
チーズ	煎餅
菓子	[発酵食品]の菓子	チーズの菓子	イージーチーズ
チーズ	イージーチーズ
チーズ	アナログチーズ
チーズの加工品	スモークチーズ
チーズ	スモークチーズ
ワイン	白ワイン
ワイン	赤ワイン
ワイン	ロゼワイン
特殊な醸造技術	補糖と補酸
特殊な醸造技術	炭酸ガス浸漬法
特殊な醸造技術	果汁再添加
芳香成分	[果実酒,調味料]の芳香成分	ワインの芳香成分	果実に由来
芳香成分	[果実酒,調味料]の芳香成分	ワインの芳香成分	マロクティック発酵に由来
芳香成分	[果実酒,調味料]の芳香成分	ワインの芳香成分	樽材に由来
芳香成分	[果実酒,調味料]の芳香成分	ワインの芳香成分	熟成
特殊な製法のワイン	発泡ワイン
ワイン	発泡ワイン
特殊な製法のワイン	酒精強化ワイン
ワイン	酒精強化ワイン
特殊な製法のワイン	貴腐ワイン
ワイン	貴腐ワイン
特殊な製法のワイン	アイスワイン
ワイン	アイスワイン
特殊な製法のワイン	氷結ワイン
ワイン	氷結ワイン
特殊な製法のワイン	麦わらワイン
ワイン	麦わらワイン
特殊な製法のワイン	にごりワイン
ワイン	にごりワイン
特殊な製法のワイン	シュール・リー
特殊な製法のワイン	フレーバードワイン
ワイン	フレーバードワイン
特殊な製法のワイン	ビオ・ワイン
ワイン	特殊な製法のワイン
ワイン	フランスワイン
ワイン	イタリアワイン
ワイン	ドイツワイン
ワイン	ルクセンブルクワイン
ワイン	スペインワイン
ワイン	モルドバワイン
産地	ニュージーランド
新緯度帯ワイン・熱帯ワイン	新緯度帯ワイン
ワイン	新緯度帯ワイン
ワイン	日本のワイン
ワインに関する事件	ジエチレングリコール混入事件
```

## Wikipediaデータの解析（試していない。100時間？）

https://dumps.wikimedia.org/jawiki/20150901/ から`jawiki-20150901-pages-meta-current.xml.bz2`をダウンロードして実行する（もっと新しいものを使ってもよい）。

（メモリが5GB以下の場合は，省メモリモードのための「`-s`」が必要）

```
bash script/ex_hyponymy.sh -E -s -t ./data3 jawiki-20150901-pages-meta-current.xml.bz2
```
