# 計算機環境の構築

## 本を探す道具

* Calilay（[Chrome版](https://chrome.google.com/webstore/detail/calilay/cafcmlkomanlkeanjkijmhepabjigeef?hl=ja)・[Firefox版](https://addons.mozilla.org/ja/firefox/addon/calilay/)）：Amazonで閲覧中の本が図書館にあるかどうかをチェックする。千葉工大の図書館と地元の図書館を登録しておく。
* Chrome + [amaruzen](https://chrome.google.com/webstore/detail/amaruzen/mebbcheaekaddnilejjllbifehngpcjj?hl=ja)：Amazonで閲覧中の本が丸善にあるかどうかをチェックする。

## Chocolatey

Windowsのためのパッケージ管理ツール[Chocolatey](https://chocolatey.org/)をインストールする。

有名なソフトウェアはだいたいChocolateyで入れられる。たとえば，

```
choco install -y chrome github atom virtualbox vagrant rsync r.project
```

とすれば，Windows上で必要なものはだいたい揃う。英語が苦手な人は，Atomにパッケージjapanese-menuを追加するといいだろう。

参考：[Chocolateyを使った環境構築の時のメモ](http://qiita.com/konta220/items/95b40b4647a737cb51aa)

## 仮想マシン

### 練習

仮想マシンについての感覚をつかむために，VirtualBox上に新規仮想マシンを作り，Ubuntu **Desktop** をインストールしてみる。

Ubuntuをゲストにする場合のtips：

* `sudo apt-get -y install virtualbox-ose-guest-utils`を実行してから再起動することで、ホストとゲストの間でのクリップボードやファイルの共有、画面サイズの変更などが可能になる。
* ホストとゲストでファイルを共有する方法：
 * デバイス→共有フォルダで共有したいホストのフォルダを選択する（Desktopだとする）。
 * Ubuntuのコンソールで`mkdir share`などとして共有用のフォルダを作る。
 * `sudo mount -t vboxsf Desktop share`などとしてマウントする。フォルダ`share`がホストのDesktopと同じになる。
* [VirtualBox 最大パフォーマンスでUbuntu環境を構築する](http://holybea.com/2015/07/08/virtualbox-ubuntu/)
* CPU負荷を軽くするために，`sudo apt-get -y install compizconfig-settings-manager`としてから`ccsm`でCompizConfig設定マネージャを起動し，OpenGLのテクスチャ・フィルタを「速さ重視」に，垂直ブランクに同期化をオフにする。

### 本番

開発はVagrantの仮想マシン上で行う。仮想マシンの置き場所は`C:/vagrant`とする。

```
c:
cd /
mkdir vagrant
cd vagrant
```

Ubuntuの仮想マシンを作る。

```
mkdir ubuntu
cd ubuntu
vagrant init puphpet/ubuntu1404-x64
vagrant up
```

おまけ：CentOSの場合

```
cd /vagrant
mkdir centos
cd centos
vagrant init puphpet/centos65-x64
vagrant up
```

上で使ったVagrantのボックス（Ubuntuの`ubuntu/trusty64`やCentOSの`puphpet/centos65-x64`）は https://atlas.hashicorp.com/boxes/search で探せる。（あとで矢吹研公式Dockerイメージを作るかもしれない。）

#### SSH接続

コマンドプロンプトで`vagrant ssh`として接続できる（パスワード入力不要）。コマンドプロンプトのタイトルバーを右クリックし，プロパティの設定を開き，簡易編集モードを有効にしておく（選択してEnterでコピー，右クリックで貼り付けができるようになる）。

本格的に使うなら，（Chocolateyで入れられる）TeraTermなどの専用クライアントが便利かもしれない。クライアントからは，`127.0.0.1`（ポート`2222`）にユーザ名`vagrant`，パスワード`vagrat`で接続する。

#### 共有フォルダ

ホストの`c:/vagrant/ubuntu`（CentOSなら`c:/vagrant/centos`）とゲストの`/vagrant`が同じフォルダになっている。このフォルダで作業するといろいろ便利だが（たとえば，ホストのエディタや統合開発環境でコードを書き，ゲストで実行する），シンボリックリンク（とは何かは後でわかるはず）を張れないことが問題になることがあるかもしれない。（たとえば`npm`にはオプション`--no-bin-links`を付ける必要がある。）

#### ウェブサーバ

ホストからアクセスするために，Vagfileの以下の項目を有効にして再起動する。

```
config.vm.network "forwarded_port", guest: 80, host: 8080
```

こうすることで，ホストのhttp://localhost:8080/ へのアクセスが，ゲストのhttp://localhost/ へのアクセスになる（Firewallを通過できるようにする必要がある）。

ゲストでウェブサーバをインストール・起動する。

Ubuntuの場合：

```
sudo apt-get install apahce2
```

CentOSの場合（おまけ）：

```
sudo yum install httpd
sudo service httpd start
```

#### 仮想マシンの再起動と停止，削除

* 再起動：`vagrant reload`
* 停止：`vagrant halt`
* 削除：`vagrant destroy`

#### おまけ：初期設定の自動化（Ubuntu）

例として，ウェブサーバをインストールして，そのドキュメントルート（ゲストの`/var/www/html`）を`c:/vagrant/ubuntu/html`にする作業を自動化する。

次のような`c:/vagrant/ubuntu/provision.sh`を作る。

```
#!/usr/bin/env bash

apt-get update
apt-get install -y apache2
rm -rf /var/www/html
ln -fs /vagrant/html /var/www/html
```

次のような`c:/vagrant/ubuntu/html/index.html`を作る。

```
<html>
<body>
hello, world
</body>
</html>
```

`c:/vagrant/ubuntu/Vagrant`の適切な場所に以下を追記する。

```
config.vm.provision "shell", path: "provision.sh"
```

仮想マシンで実行する。

```
vagrant provision
```

初めての`vagrant up`や，停止時の`vagrant up --provision`でも上記スクリプトが実行される。

## Linuxの勉強

Ubuntuが動くようになったら，[LPIC『Linux標準教科書』](http://www.lpi.or.jp/linuxtext/text.shtml)を読む。この資料に書かれていることは，**すべて試して** 納得しておくこと。この資料はCentOS向けに書かれているが，`yum`を`apt-get`に置き換えれば，Ubuntuでもだいたい動くだろう。
